@using Microsoft.AspNetCore.Components
@using ModUlar.services
@inject SettingModifierService Modifier
@inject IToastService toastService

<div class="setting-card">
    <div class="setting-card-header">
        <span class="setting-title">@Setting.Name</span>
        <input type="checkbox" checked="@Setting.Activo" @onchange="HandleSettingChange"/>
    </div>
    <div class="setting-card-desc">
        @Setting.Description
    </div>
</div>

@code {

    private void HandleSettingChange(ChangeEventArgs e)
    {
        try
        {
            Modifier.ModifySetting(Setting, ModFolder);
            Setting.Activo = (bool)e.Value;
            
            if (Setting.Activo)
            {
                toastService.ShowSuccess($"Setting '{Setting.Name}' activated");
            }
            else
            {
                toastService.ShowWarning($"Setting '{Setting.Name}' disabled");
            }
        }
        catch (IOException exception)
        {
            bool changeTry = (bool)e.Value;
            string action = changeTry ? "activating" : "disabling";
            toastService.ShowError($"Error {action} {Setting.Name}: Try {action} the setting with the game closed");
            InvokeAsync(StateHasChanged);
        }
    }

}